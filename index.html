<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>ææ˜Ÿå¨…çš„ç”Ÿæ—¥ç¥ç¦ - æ˜Ÿç©ºå¯„è¯­</title>
    <!-- å¼•å…¥æ‰‹å†™ä½“å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            overflow: hidden;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Roboto, sans-serif;
            cursor: default;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: radial-gradient(ellipse 100% 120% at 50% 40%, 
                rgba(15, 23, 42, 0.4) 0%, 
                rgba(7, 14, 30, 0.8) 40%, 
                rgba(2, 6, 15, 0.95) 70%, 
                #000000 100%);
            backdrop-filter: brightness(1.1) contrast(1.05);
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* å¼€åœºåŠ¨ç”»é®ç½© */
        #opening-mask {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(2, 6, 15, 1) 0%, 
                rgba(7, 14, 30, 1) 50%, 
                rgba(2, 6, 15, 1) 100%);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 2.5s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        #opening-text {
            color: #ffffff;
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            opacity: 0;
            animation: sophisticatedFadeIn 4s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
            text-shadow: 0 4px 12px rgba(255, 255, 255, 0.15),
                         0 2px 6px rgba(255, 255, 255, 0.25);
        }

        @keyframes sophisticatedFadeIn {
            0% { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
                filter: blur(3px);
            }
            25% { 
                opacity: 0.6; 
                transform: translateY(15px) scale(0.98); 
                filter: blur(1px);
            }
            50% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
                filter: blur(0);
            }
            85% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-15px) scale(1.02); 
                filter: blur(2px);
            }
        }

        /* ç¥ç¦å¼¹çª— */
        #blessing-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, 
                rgba(15, 23, 42, 0.7) 0%, 
                rgba(2, 6, 15, 0.9) 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 500;
            backdrop-filter: blur(20px) saturate(1.2);
            transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        #blessing-content {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.08) 0%, 
                rgba(255, 255, 255, 0.03) 50%,
                rgba(255, 255, 255, 0.06) 100%);
            padding: 70px 50px;
            border-radius: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.25),
                0 10px 25px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: scale(0.85) translateY(20px);
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        #blessing-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.03) 0%, 
                transparent 70%);
            animation: shimmer 4s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.6; }
        }

        #blessing-content.show {
            transform: scale(1) translateY(0);
        }

        #blessing-text {
            color: #ffffff;
            font-size: 2.8rem;
            font-family: 'Dancing Script', cursive;
            font-weight: 600;
            margin-bottom: 25px;
            letter-spacing: 0.01em;
            line-height: 1.2;
            text-shadow: 
                0 4px 12px rgba(255, 255, 255, 0.2),
                0 2px 6px rgba(255, 215, 0, 0.3),
                0 8px 25px rgba(255, 255, 255, 0.1);
            animation: elegantSparkle 3s ease-in-out infinite, 
                       subtleGlow 4s ease-in-out infinite;
            position: relative;
            z-index: 2;
        }

        #blessing-text::before,
        #blessing-text::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: floatParticles 4s infinite ease-in-out;
        }

        #blessing-text::before {
            top: -10px;
            left: 20%;
            animation-delay: 0s;
        }

        #blessing-text::after {
            bottom: -10px;
            right: 25%;
            animation-delay: 2s;
        }

        @keyframes elegantSparkle {
            0%, 100% { 
                text-shadow: 
                    0 4px 12px rgba(255, 255, 255, 0.2),
                    0 2px 6px rgba(255, 215, 0, 0.3),
                    0 8px 25px rgba(255, 255, 255, 0.1);
            }
            50% { 
                text-shadow: 
                    0 4px 15px rgba(255, 255, 255, 0.4),
                    0 2px 8px rgba(255, 215, 0, 0.5),
                    0 10px 30px rgba(255, 255, 255, 0.2);
            }
        }

        @keyframes subtleGlow {
            0%, 100% { 
                transform: scale(1) translateY(0);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.01) translateY(-1px);
                filter: brightness(1.05);
            }
        }

        @keyframes floatParticles {
            0% { 
                transform: translateY(0) scale(1); 
                opacity: 0;
            }
            20% { 
                opacity: 1;
            }
            80% { 
                opacity: 1;
                transform: translateY(-30px) scale(0.8);
            }
            100% { 
                transform: translateY(-50px) scale(0); 
                opacity: 0;
            }
        }

        @keyframes sparkle {
            0%, 100% { text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3); }
            50% { text-shadow: 0 2px 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.3); }
        }

        #blessing-heart {
            font-size: 3rem;
            color: #ff6b9d;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ç…§ç‰‡å›å¿†å¡ç‰‡ */
        #memory-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, 
                rgba(15, 23, 42, 0.8) 0%, 
                rgba(2, 6, 15, 0.95) 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 500;
            backdrop-filter: blur(25px) saturate(1.3);
        }

        #memory-card {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.09) 0%, 
                rgba(255, 255, 255, 0.04) 50%,
                rgba(255, 255, 255, 0.07) 100%);
            padding: 45px;
            border-radius: 28px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.3),
                0 15px 35px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
            max-width: 520px;
            transform: translateY(40px) scale(0.9);
            opacity: 0;
            transition: all 0.7s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        #memory-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                rgba(255, 255, 255, 0.1) 0%,
                transparent 30%,
                transparent 70%, 
                rgba(255, 255, 255, 0.1) 100%);
            border-radius: 28px;
            z-index: -1;
            opacity: 0;
            animation: cardBorderGlow 3s ease-in-out infinite;
        }

        @keyframes cardBorderGlow {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        #memory-card.show {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        #memory-image {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: linear-gradient(45deg, #ff6b9d, #4ecdc4);
            border-radius: 15px;
            margin: 0 auto 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.2rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        #memory-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
            transition: transform 0.3s ease;
        }

        #memory-image:hover img {
            transform: scale(1.05);
        }

        #memory-image .placeholder-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 2;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        /* ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ– */
        @media (max-width: 768px) {
            #memory-image {
                max-width: 90vw;
                height: 40vh;
                max-height: 250px;
            }
            
            #memory-card {
                max-width: 90vw;
                padding: 20px 15px;
            }
            
            #blessing-text {
                font-size: 1.8rem;
                line-height: 1.3;
            }
            
            #memory-title {
                font-size: 1.1rem;
            }
            
            #memory-description {
                font-size: 0.85rem;
                line-height: 1.4;
            }
            
            #controls-hint {
                font-size: 0.75rem;
                padding: 6px 10px;
                bottom: 10px;
                left: 10px;
            }
            
            #music-control {
                width: 35px;
                height: 35px;
                top: 15px;
                right: 15px;
                font-size: 14px;
            }
            
            #constellation-tooltip {
                font-size: 0.8rem;
                padding: 6px 10px;
                max-width: 80vw;
            }
        }

        #memory-title {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 15px;
            font-weight: 300;
        }

        #memory-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            line-height: 1.6;
        }

        /* æ˜Ÿåº§ä¿¡æ¯æç¤º */
        #constellation-tooltip {
            position: absolute;
            background: linear-gradient(135deg, 
                rgba(15, 23, 42, 0.9) 0%, 
                rgba(2, 6, 15, 0.95) 100%);
            color: #ffffff;
            padding: 12px 18px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px) saturate(1.2);
            transform: translateY(10px) scale(0.9);
            box-shadow: 
                0 15px 30px rgba(0, 0, 0, 0.2),
                0 8px 20px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            letter-spacing: 0.01em;
        }

        #constellation-tooltip::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(15, 23, 42, 0.9);
        }

        /* æ§åˆ¶æç¤º */
        #controls-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.04) 0%, 
                rgba(255, 255, 255, 0.02) 100%);
            color: rgba(255, 255, 255, 0.8);
            padding: 14px 24px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 400;
            border: 1px solid rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px) saturate(1.1);
            z-index: 10;
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.1),
                0 4px 10px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            letter-spacing: 0.01em;
        }

        #controls-hint:hover {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.06) 0%, 
                rgba(255, 255, 255, 0.03) 100%);
            color: rgba(255, 255, 255, 0.95);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 
                0 12px 28px rgba(0, 0, 0, 0.15),
                0 6px 14px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }

        /* éŸ³ä¹æ§åˆ¶ */
        #music-control {
            position: absolute;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.06) 0%, 
                rgba(255, 255, 255, 0.03) 100%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 50px;
            padding: 12px 18px;
            color: #ffffff;
            cursor: pointer;
            z-index: 10;
            backdrop-filter: blur(20px) saturate(1.2);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.12),
                0 4px 10px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            font-weight: 500;
            font-size: 0.95rem;
        }

        #music-control:hover {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 12px 28px rgba(0, 0, 0, 0.18),
                0 6px 14px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        #music-control:active {
            transform: translateY(0) scale(0.98);
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        #progress-indicator {
            position: absolute;
            top: 30px;
            left: 30px;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.05) 0%, 
                rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            padding: 18px 24px;
            color: #ffffff;
            z-index: 10;
            backdrop-filter: blur(20px) saturate(1.2);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Roboto, sans-serif;
            min-width: 170px;
            opacity: 0.92;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.15),
                0 4px 10px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        #progress-indicator:hover {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.08) 0%, 
                rgba(255, 255, 255, 0.04) 100%);
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 
                0 12px 28px rgba(0, 0, 0, 0.2),
                0 6px 14px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .progress-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            text-align: center;
        }

        .progress-stars {
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffdd44);
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        @media (max-width: 768px) {
            #progress-indicator {
                top: 15px;
                left: 15px;
                padding: 6px 10px;
                min-width: 120px;
                font-size: 0.75rem;
            }
            
            .progress-text {
                font-size: 0.7rem;
            }
            
            .progress-stars {
                font-size: 0.9rem;
            }
        }
        
        /* è¶…å°å±å¹•é€‚é… */
        @media (max-width: 480px) {
            #blessing-text {
                font-size: 1.5rem;
            }
            
            #memory-image {
                height: 35vh;
                max-height: 200px;
            }
            
            #memory-card, #blessing-content {
                width: 95vw;
                padding: 15px 10px;
            }
            
            #controls-hint {
                font-size: 0.7rem;
                padding: 4px 8px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="container">
        <!-- å¼€åœºåŠ¨ç”» -->
        <div id="opening-mask">
            <div id="opening-text">ä¸ºææ˜Ÿå¨…ç‚¹äº®æ˜Ÿç©º</div>
        </div>

        <!-- Three.js ç”»å¸ƒå®¹å™¨ -->
        <div id="canvas-container"></div>

        <!-- ç¥ç¦å¼¹çª— -->
        <div id="blessing-modal">
            <div id="blessing-content">
                <div id="blessing-text">ç¥å®è´å¤©å¤©å¼€å¿ƒï¼Œæ°¸è¿œ18å²</div>
                <div id="blessing-heart">â¤ï¸</div>
            </div>
        </div>

        <!-- ç…§ç‰‡å›å¿†å¼¹çª— -->
        <div id="memory-modal">
            <div id="memory-card">
                <div id="memory-image">
                    <div class="placeholder-text">
                        <div>ğŸ“¸</div>
                        <div>ç¾å¥½çš„å›å¿†ç…§ç‰‡</div>
                        <div style="font-size: 0.8rem; margin-top: 10px;">è¯·å°†ç…§ç‰‡æ”¾åœ¨photosæ–‡ä»¶å¤¹ä¸­</div>
                    </div>
                </div>
                <div id="memory-title">é‚£ä¸€å¤©çš„å›å¿†</div>
                <div id="memory-description">åœ¨è¿™é‡Œå¯ä»¥æ”¾ç½®é‚£å¤©çš„ç…§ç‰‡å’Œç¾å¥½å›å¿†...</div>
            </div>
        </div>

        <!-- æ˜Ÿåº§ä¿¡æ¯æç¤º -->
        <div id="constellation-tooltip"></div>

        <!-- æ§åˆ¶æç¤º -->
        <div id="controls-hint">
            é¼ æ ‡æ‹–æ‹½ç§»åŠ¨è§†è§’ | æ»šè½®ç¼©æ”¾ | ç‚¹å‡»æ˜Ÿåº§æŸ¥çœ‹ç¥ç¦
        </div>

        <!-- éŸ³ä¹æ§åˆ¶ -->
        <div id="music-control" onclick="toggleMusic()">
            ğŸµ éŸ³ä¹
        </div>

        <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div id="progress-indicator">
            <div class="progress-text">æ¢ç´¢è¿›åº¦</div>
            <div class="progress-stars">
                <span id="progress-count">0</span>/9 â­
            </div>
            <div class="progress-bar">
                <div id="progress-fill"></div>
            </div>
        </div>

        <!-- èƒŒæ™¯éŸ³ä¹ -->
        <audio id="background-music" loop>
            <source src="theme-of-exodus.mp3" type="audio/mpeg">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
        </audio>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- è½¨é“æ§åˆ¶å™¨ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let scene, camera, renderer, controls;
        let starField;
        let leoConstellation = {};
        let leoStars = [];
        let leoLines = [];
        let isInitialized = false;
        let musicPlaying = false;

        // ç‚¹å‡»è¿›åº¦è·Ÿè¸ª
        let clickedStars = new Set(); // å·²ç‚¹å‡»çš„æ˜Ÿæ˜Ÿåç§°
        let allStarsClickedTriggered = false; // æ˜¯å¦å·²è§¦å‘å®Œæˆå½©è›‹
        let firstBlessingShown = false; // æ˜¯å¦å·²æ˜¾ç¤ºè¿‡ç¬¬ä¸€æ¬¡ç¥ç¦

        // ç‹®å­åº§æ’æ˜Ÿæ•°æ®ï¼ˆç”¨æˆ·æä¾›çš„ç²¾ç¡®åæ ‡ï¼‰
        const leoStarsData = [
            { name: 'Regulus', bayer: 'Î± Leo', x: -0.864493, y: 0.457886, z: 0.207347, magnitude: 1.4 },
            { name: 'Denebola', bayer: 'Î² Leo', x: -0.966729, y: 0.046224, z: 0.251591, magnitude: 2.1 },
            { name: 'Algieba', bayer: 'Î³Â¹ Leo', x: -0.852446, y: 0.397653, z: 0.339422, magnitude: 2.6 },
            { name: 'Zosma', bayer: 'Î´ Leo', x: -0.917810, y: 0.186313, z: 0.350589, magnitude: 2.6 },
            { name: 'Algenubi', bayer: 'Îµ Leo', x: -0.762793, y: 0.505600, z: 0.403133, magnitude: 3.0 },
            { name: 'Adhafera', bayer: 'Î¶ Leo', x: -0.825963, y: 0.399805, z: 0.397419, magnitude: 3.4 },
            { name: 'Al Jabhah', bayer: 'Î· Leo', x: -0.844085, y: 0.452041, z: 0.284835, magnitude: 3.5 },
            { name: 'Chertan', bayer: 'Î¸ Leo', x: -0.944803, y: 0.191221, z: 0.266047, magnitude: 3.3 },
            { name: 'Rasalas', bayer: 'Î¼ Leo', x: -0.763732, y: 0.473764, z: 0.438476, magnitude: 3.9 }
        ];

        // ç‹®å­åº§è¿çº¿é…ç½®
        const leoConnections = [
            // é•°åˆ€ï¼ˆå¤´éƒ¨ï¼‰- å¹³æ»‘è´å¡å°”æ›²çº¿
            ['Îµ Leo', 'Î¼ Leo'], ['Î¼ Leo', 'Î¶ Leo'], ['Î¶ Leo', 'Î³Â¹ Leo'], 
            ['Î³Â¹ Leo', 'Î· Leo'], ['Î· Leo', 'Î± Leo'],
            // èº«ä½“ä¸å°¾å·´
            ['Î± Leo', 'Î´ Leo'], ['Î´ Leo', 'Î² Leo'], ['Î´ Leo', 'Î¸ Leo']
        ];

        // åˆå§‹åŒ–
        function init() {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–Three.jsåœºæ™¯');
            
            try {
                // åˆ›å»ºåœºæ™¯
                scene = new THREE.Scene();
                console.log('âœ… åœºæ™¯åˆ›å»ºæˆåŠŸ');
                
                // åˆ›å»ºç›¸æœº - è°ƒæ•´åˆå§‹ä½ç½®è®©ç‹®å­åº§æ¨ªå‘æ˜¾ç¤ºå¹¶å æ®ä¸»è¦ç”»é¢
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(-4, -6, 8);  // æ›´è¿‘çš„è·ç¦»ï¼Œè®©ç‹®å­åº§å æ®ç”»é¢ä¸»è¦éƒ¨åˆ†
                console.log('âœ… ç›¸æœºåˆ›å»ºæˆåŠŸ, ä½ç½®:', camera.position);
                
                // åˆ›å»ºæ¸²æŸ“å™¨
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x000000, 1);
                
                const canvasContainer = document.getElementById('canvas-container');
                if (!canvasContainer) {
                    throw new Error('æ‰¾ä¸åˆ°canvas-containerå…ƒç´ ');
                }
                canvasContainer.appendChild(renderer.domElement);
                console.log('âœ… æ¸²æŸ“å™¨åˆ›å»ºæˆåŠŸå¹¶æ·»åŠ åˆ°DOM');
                
                // æ£€æŸ¥OrbitControlsæ˜¯å¦å¯ç”¨
                if (typeof THREE.OrbitControls === 'undefined') {
                    console.error('âŒ THREE.OrbitControlsæœªåŠ è½½');
                    return;
                }
                
                // æ·»åŠ è½¨é“æ§åˆ¶å™¨
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.enableZoom = true;
                controls.enableRotate = true;
                controls.enablePan = true;
                controls.minDistance = 1;
                controls.maxDistance = 15;
                // è®¾ç½®åˆå§‹æ—‹è½¬è§’åº¦è®©ç‹®å­åº§å‘ˆç°æ¨ªå‘å§¿æ€
                controls.target.set(0, 0, 0);
                camera.lookAt(0, 0, 0);
                console.log('âœ… æ§åˆ¶å™¨åˆ›å»ºæˆåŠŸ');
                
                // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
                console.log('ğŸŒŒ å¼€å§‹åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯');
                createStarField();
                console.log('âœ… æ˜Ÿç©ºèƒŒæ™¯åˆ›å»ºå®Œæˆ');
                
                // åˆ›å»ºç‹®å­åº§
                console.log('ğŸ¦ å¼€å§‹åˆ›å»ºç‹®å­åº§');
                createLeoConstellation();
                console.log('âœ… ç‹®å­åº§åˆ›å»ºå®Œæˆï¼Œæ˜Ÿæ˜Ÿæ•°é‡:', leoStars.length);
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                console.log('ğŸ¯ æ·»åŠ äº‹ä»¶ç›‘å¬å™¨');
                addEventListeners();
                console.log('âœ… äº‹ä»¶ç›‘å¬å™¨æ·»åŠ å®Œæˆ');
                
                // å¼€å§‹åŠ¨ç”»å¾ªç¯
                console.log('ğŸ¬ å¼€å§‹åŠ¨ç”»å¾ªç¯');
                animate();
                
                // å¼€åœºåŠ¨ç”»
                console.log('âœ¨ å¼€å§‹æ’­æ”¾å¼€åœºåŠ¨ç”»');
                startOpeningAnimation();
                
                console.log('ğŸ‰ Three.jsåœºæ™¯åˆå§‹åŒ–å®Œæˆï¼åœºæ™¯å¯¹è±¡æ•°:', scene.children.length);
                
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                console.error('é”™è¯¯å †æ ˆ:', error.stack);
                alert('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯ - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 800; // å‡å°‘æ˜Ÿæ˜Ÿæ•°é‡æå‡æ€§èƒ½
            
            const positions = new Float32Array(starCount * 3);
            const colors = new Float32Array(starCount * 3);
            const sizes = new Float32Array(starCount);
            
            for (let i = 0; i < starCount; i++) {
                // è®©èƒŒæ™¯æ˜Ÿæ˜Ÿè·ç¦»æ›´è¿œï¼Œçªå‡ºç‹®å­åº§
                const radius = Math.random() * 10 + 25; // æ›´è¿œçš„è·ç¦»
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(Math.random() * 2 - 1);
                
                positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
                positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
                positions[i * 3 + 2] = radius * Math.cos(phi);
                
                // ç®€åŒ–é¢œè‰²è®¡ç®—ï¼Œæå‡æ€§èƒ½
                const colorType = Math.floor(Math.random() * 3);
                let r, g, b;
                switch (colorType) {
                    case 0: // è“ç™½è‰²
                        r = 0.4; g = 0.45; b = 0.5;
                        break;
                    case 1: // é»„ç™½è‰²
                        r = 0.5; g = 0.45; b = 0.35;
                        break;
                    default: // æ©™è‰²
                        r = 0.4; g = 0.3; b = 0.2;
                }
                
                colors[i * 3] = r;
                colors[i * 3 + 1] = g;
                colors[i * 3 + 2] = b;
                
                // ç¨å¾®å¢åŠ æ˜Ÿæ˜Ÿå¤§å°çš„å˜åŒ–
                sizes[i] = 0.08 + Math.random() * 0.03;
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            starGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
            
            const starMaterial = new THREE.PointsMaterial({
                size: 0.1, // ç¨å¾®æ”¾å¤§èƒŒæ™¯æ˜Ÿæ˜Ÿ
                sizeAttenuation: true,
                vertexColors: true,
                transparent: true,
                opacity: 0.6, // ç¨å¾®æé«˜é€æ˜åº¦è®©æ˜Ÿæ˜Ÿæ›´æ˜æ˜¾
                blending: THREE.AdditiveBlending,
                alphaTest: 0.3 // é™ä½alphaæµ‹è¯•é˜ˆå€¼è®©æ›´å¤šæ˜Ÿæ˜Ÿå¯è§
            });
            
            starField = new THREE.Points(starGeometry, starMaterial);
            scene.add(starField);
            
            // æ·»åŠ æ˜Ÿç©ºé—ªçƒåŠ¨ç”»
            animateStarField();
        }

        // æ˜Ÿç©ºé—ªçƒåŠ¨ç”» - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
        function animateStarField() {
            let time = 0;
            let lastFrameTime = 0;
            const targetFPS = 15; // é™ä½åˆ°15fps
            const frameInterval = 1000 / targetFPS;
            
            const twinkle = (currentTime) => {
                if (currentTime - lastFrameTime >= frameInterval) {
                    time += 0.01;
                    if (starField && starField.material) {
                        starField.material.opacity = 0.8 + Math.sin(time * 0.5) * 0.08;
                    }
                    lastFrameTime = currentTime;
                }
                requestAnimationFrame(twinkle);
            };
            
            requestAnimationFrame(twinkle);
        }

        // æ’æ˜Ÿè‰²å½©æ˜ å°„ - åŸºäºæ˜Ÿç­‰å’Œå…‰è°±ç±»å‹
        function getStarColor(magnitude) {
            // æ ¹æ®æ˜Ÿç­‰è¿”å›é€¼çœŸçš„æ’æ˜Ÿé¢œè‰²
            if (magnitude < 1.5) return 0xffffee; // æ˜äº®çš„ç™½è‰²
            if (magnitude < 2.0) return 0xffeecc; // æ·¡é»„ç™½è‰²
            if (magnitude < 2.5) return 0xffddaa; // é»„è‰²
            return 0xffcc88; // æ©™é»„è‰²
        }
        
        // ç”ŸæˆæŸ”å’Œçš„å¾„å‘å…‰æ™•çº¹ç†ï¼ˆç”¨äºæ›´å¹²å‡€çš„æ’æ˜Ÿå…‰æ•ˆï¼‰
        function createHaloTexture(innerColor = 'rgba(255,255,255,0.9)', outerColor = 'rgba(255,255,255,0)') {
            const size = 256;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
            gradient.addColorStop(0.0, innerColor);
            gradient.addColorStop(0.2, 'rgba(255,255,255,0.55)');
            gradient.addColorStop(0.5, 'rgba(255,230,180,0.25)');
            gradient.addColorStop(1.0, outerColor);
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(size/2, size/2, size/2, 0, Math.PI * 2);
            ctx.fill();
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            return texture;
        }
        
        // åˆ›å»ºæµå…‰æ•ˆæœ
        function createFlowingLight(curve, lineGroup, connectionIndex) {
            // éœ€æ±‚ï¼šå»é™¤å¾®ç²’å­æµåŠ¨ï¼Œæ­¤å‡½æ•°ä¿ç•™ç©ºå®ç°ä»¥é¿å…è°ƒç”¨æ–¹æŠ¥é”™
            return;
        }
        
        // æ›´æ–°æµå…‰ç²’å­åŠ¨ç”»
        function updateFlowingLights() {
            if (window.flowingParticles) {
                window.flowingParticles.forEach(particle => {
                    particle.progress += particle.speed;
                    
                    // å¾ªç¯åŠ¨ç”»
                    if (particle.progress > 1) {
                        particle.progress = 0;
                    }
                    
                    // æ›´æ–°ç²’å­ä½ç½®
                    const position = particle.curve.getPoint(particle.progress);
                    particle.mesh.position.copy(position);
                    
                    // æ¸å˜é€æ˜åº¦æ•ˆæœ - å¤´éƒ¨å’Œå°¾éƒ¨æ·¡åŒ–
                    const fadeIn = Math.min(particle.progress * 5, 1);
                    const fadeOut = Math.min((1 - particle.progress) * 5, 1);
                    const alpha = Math.min(fadeIn, fadeOut) * particle.baseOpacity;
                    
                    particle.mesh.material.opacity = alpha;
                    if (particle.mesh.children[0]) {
                        particle.mesh.children[0].material.opacity = alpha * 0.6;
                    }
                });
            }
        }

        // åˆ›å»ºç‹®å­åº§
        function createLeoConstellation() {
            const starGroup = new THREE.Group();
            const lineGroup = new THREE.Group();
            
            // æ·»åŠ ç¯å¢ƒå…‰å¢å¼ºæè´¨æ•ˆæœ
            const ambientLight = new THREE.AmbientLight(0x404050, 0.3);
            scene.add(ambientLight);
            
            // æ·»åŠ ç‚¹å…‰æºå¢å¼ºæ˜Ÿæ˜Ÿå…‰æ•ˆ
            const pointLight = new THREE.PointLight(0xffffcc, 0.4, 100);
            pointLight.position.set(0, 0, 10);
            scene.add(pointLight);
            
            // ç»Ÿä¸€ä½¿ç”¨å›ºå®šåŠå¾„ï¼Œç¡®ä¿æ˜Ÿæ˜Ÿå’Œè¿çº¿åœ¨åŒä¸€ä½ç½®
            const fixedRadius = 5;
            
            // åˆ›å»ºç‹®å­åº§æ’æ˜Ÿ
            leoStarsData.forEach((starData, index) => {
                const starSize = 0.06 + (4 - starData.magnitude) * 0.03;
                const starGeometry = new THREE.SphereGeometry(starSize, 24, 24);
                const starColor = getStarColor(starData.magnitude);
                const starMaterial = new THREE.MeshBasicMaterial({
                    color: starColor,
                    transparent: true,
                    opacity: 0.9
                });
                const star = new THREE.Mesh(starGeometry, starMaterial);
                star.position.set(
                    starData.x * fixedRadius,
                    starData.y * fixedRadius,
                    starData.z * fixedRadius
                );
                
                // ä½¿ç”¨å•å±‚ç²¾çµå…‰æ™•ï¼Œé¿å…å¤šå±‚çƒä½“å å½±
                const haloTexture = createHaloTexture('rgba(255,255,255,0.9)', 'rgba(255,255,255,0)');
                const haloMaterial = new THREE.SpriteMaterial({
                    map: haloTexture,
                    color: new THREE.Color(starColor),
                    transparent: true,
                    opacity: 0.5,
                    depthTest: false,
                    blending: THREE.AdditiveBlending
                });
                const halo = new THREE.Sprite(haloMaterial);
                halo.position.copy(star.position);
                const haloSize = starSize * 9.0; // æ˜æ˜¾å¯è§çš„æŸ”å’Œå…‰æ™•
                halo.scale.set(haloSize, haloSize, 1);
                halo.userData = { baseOpacity: 0.5 };
                
                // å­˜å‚¨æ˜Ÿæ˜Ÿæ•°æ®ï¼ŒåŒ…æ‹¬ç»Ÿä¸€çš„åŠå¾„
                star.userData = {
                    starData: starData,
                    index: index,
                    originalScale: star.scale.clone(),
                    radius: fixedRadius,
                    glowLayers: [halo]
                };
                
                leoStars.push(star);
                starGroup.add(star);
                starGroup.add(halo);
            });
            
            // åˆ›å»ºä¼˜é›…çš„æ›²çº¿è¿çº¿ç³»ç»Ÿ
            leoConnections.forEach((connection, connectionIndex) => {
                const star1 = leoStarsData.find(s => s.bayer === connection[0]);
                const star2 = leoStarsData.find(s => s.bayer === connection[1]);
                
                if (star1 && star2) {
                    const start = new THREE.Vector3(star1.x * fixedRadius, star1.y * fixedRadius, star1.z * fixedRadius);
                    const end = new THREE.Vector3(star2.x * fixedRadius, star2.y * fixedRadius, star2.z * fixedRadius);
                    
                    // åˆ›å»ºæ§åˆ¶ç‚¹ä»¥å½¢æˆä¼˜é›…çš„æ›²çº¿
                    const midPoint = new THREE.Vector3().lerpVectors(start, end, 0.5);
                    const distance = start.distanceTo(end);
                    const offset = distance * 0.12; // æ›²çº¿å¼¯æ›²ç¨‹åº¦
                    
                    // è®¡ç®—å‚ç›´äºè¿çº¿çš„åç§»å‘é‡
                    const direction = new THREE.Vector3().subVectors(end, start).normalize();
                    const perpendicular = new THREE.Vector3(-direction.y, direction.x, direction.z * 0.3).normalize();
                    
                    // åˆ›å»ºæ§åˆ¶ç‚¹
                    const controlPoint1 = start.clone().lerp(midPoint, 0.4).add(perpendicular.clone().multiplyScalar(offset));
                    const controlPoint2 = end.clone().lerp(midPoint, 0.4).add(perpendicular.clone().multiplyScalar(-offset));
                    
                    // ä½¿ç”¨CatmullRomæ›²çº¿åˆ›å»ºå¹³æ»‘è·¯å¾„
                    const curve = new THREE.CatmullRomCurve3([
                        start,
                        controlPoint1,
                        controlPoint2,
                        end
                    ], false, 'catmullrom', 0.3);
                    
                    // æ”¹ä¸ºç›´çº¿æ®µï¼ˆæ— å¼¯æ›²ï¼‰ã€åŠé€æ˜æŸ”å’Œ
                    const straightPoints = [start, end];
                    const lineGeometry = new THREE.BufferGeometry().setFromPoints(straightPoints);
                    const lineMaterial = new THREE.LineBasicMaterial({
                        color: 0x6fb7d8,
                        transparent: true,
                        opacity: 0.28,
                        linewidth: 1.5
                    });
                    const straightLine = new THREE.Line(lineGeometry, lineMaterial);
                    lineGroup.add(straightLine);
                    leoLines.push(straightLine);
                    
                    // ç§»é™¤å¾®ç²’å­æµåŠ¨ï¼ˆæŒ‰éœ€æ±‚ï¼‰
                }
            });
            
            leoConstellation.stars = starGroup;
            leoConstellation.lines = lineGroup;
            scene.add(starGroup);
            scene.add(lineGroup);
        }

        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        function addEventListeners() {
            console.log('ğŸ¯ å¼€å§‹æ·»åŠ äº‹ä»¶ç›‘å¬å™¨');
            console.log('ğŸ–¼ï¸ æ¸²æŸ“å™¨DOMå…ƒç´ :', renderer.domElement);
            
            // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
            renderer.domElement.addEventListener('click', onStarClick);
            console.log('âœ… ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ åˆ°canvas');
            
            // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶
            renderer.domElement.addEventListener('touchend', onTouchEnd, { passive: false });
            console.log('âœ… è§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ åˆ°canvas');
            
            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼ˆæ‚¬åœï¼‰
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            console.log('âœ… é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ ');
            
            // æ·»åŠ é€šç”¨ç‚¹å‡»æµ‹è¯•
            renderer.domElement.addEventListener('click', function(e) {
                console.log('ğŸ–±ï¸ Canvasè¢«ç‚¹å‡»äº†ï¼åæ ‡:', e.clientX, e.clientY);
            });
            
            // çª—å£å¤§å°æ”¹å˜
            window.addEventListener('resize', onWindowResize);
            
            // å¼¹çª—å…³é—­
            document.getElementById('blessing-modal').addEventListener('click', closeBlessingModal);
            document.getElementById('memory-modal').addEventListener('click', closeMemoryModal);
            
            // éŸ³ä¹æ§åˆ¶æŒ‰é’®
            const musicControl = document.getElementById('music-control');
            if (musicControl) {
                musicControl.onclick = toggleMusic;
                // æ·»åŠ è§¦æ‘¸æ”¯æŒ
                musicControl.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    toggleMusic();
                });
                console.log('âœ… éŸ³ä¹æ§åˆ¶æŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            }
            
            console.log('ğŸ¯ æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨æ·»åŠ å®Œæˆ');
        }

        // è§¦æ‘¸äº‹ä»¶å¤„ç†
        function onTouchEnd(event) {
            console.log('ğŸ“± è§¦æ‘¸äº‹ä»¶è§¦å‘');
            event.preventDefault();
            
            if (event.changedTouches && event.changedTouches.length > 0) {
                const touch = event.changedTouches[0];
                console.log('ğŸ‘† è§¦æ‘¸åæ ‡:', touch.clientX, touch.clientY);
                
                // åˆ›å»ºæ¨¡æ‹Ÿçš„é¼ æ ‡äº‹ä»¶å¯¹è±¡
                const simulatedEvent = {
                    clientX: touch.clientX,
                    clientY: touch.clientY,
                    preventDefault: () => event.preventDefault(),
                    stopPropagation: () => event.stopPropagation()
                };
                
                // è°ƒç”¨æ˜Ÿæ˜Ÿç‚¹å‡»å¤„ç†å‡½æ•°
                handleStarInteraction(simulatedEvent);
            }
        }
        
        // æ˜Ÿæ˜Ÿç‚¹å‡»äº‹ä»¶ - å¢å¼ºäº¤äº’åé¦ˆ
        function onStarClick(event) {
            console.log('â­ é¼ æ ‡ç‚¹å‡»äº‹ä»¶è§¦å‘ï¼åæ ‡:', event.clientX, event.clientY);
            handleStarInteraction(event);
        }
        
        // ç»Ÿä¸€çš„æ˜Ÿæ˜Ÿäº¤äº’å¤„ç†å‡½æ•°
        function handleStarInteraction(event) {
            console.log('ğŸ¯ å¤„ç†æ˜Ÿæ˜Ÿäº¤äº’ï¼Œåæ ‡:', event.clientX, event.clientY);
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œç¡®ä¿åªå¤„ç†ä¸€æ¬¡
            event.preventDefault();
            event.stopPropagation();
            
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            console.log('ğŸ“ æ ‡å‡†åŒ–åæ ‡:', mouse.x, mouse.y);
            
            const raycaster = new THREE.Raycaster();
            // ç§»åŠ¨ç«¯éœ€è¦æ›´å¤§çš„æ£€æµ‹èŒƒå›´
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            raycaster.params.Points.threshold = isMobile ? 1.5 : 0.5;
            raycaster.setFromCamera(mouse, camera);
            
            console.log('ğŸ” raycasterè®¾ç½®å®Œæˆï¼Œæ£€æµ‹èŒƒå›´:', raycaster.params.Points.threshold);
            console.log('ğŸ“Š æ£€æµ‹å¯¹è±¡æ•°ç»„:', leoStars.length, 'ä¸ªæ˜Ÿæ˜Ÿ');
            
            const intersects = raycaster.intersectObjects(leoStars);
            console.log(`ğŸ¯ æ£€æµ‹ç»“æœ: ${intersects.length} ä¸ªäº¤äº’å¯¹è±¡`);
            
            // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ï¼Œå¢å¤§æ£€æµ‹èŒƒå›´å†è¯•ä¸€æ¬¡
            if (intersects.length === 0) {
                console.log('ğŸ”„ ç¬¬ä¸€æ¬¡æ£€æµ‹å¤±è´¥ï¼Œå°è¯•å¢å¤§æ£€æµ‹èŒƒå›´');
                raycaster.params.Points.threshold = isMobile ? 2.5 : 1.0;
                const secondTry = raycaster.intersectObjects(leoStars);
                console.log(`ğŸ”„ ç¬¬äºŒæ¬¡æ£€æµ‹ç»“æœ: ${secondTry.length} ä¸ªäº¤äº’å¯¹è±¡`);
                
                if (secondTry.length > 0) {
                    intersects.push(...secondTry);
                }
            }
            
            // è°ƒè¯•ï¼šæ˜¾ç¤ºæ‰€æœ‰æ˜Ÿæ˜Ÿçš„ä½ç½®å’Œç›¸æœºä¿¡æ¯
            if (intersects.length === 0) {
                console.log('ğŸ“ è°ƒè¯•ä¿¡æ¯:');
                console.log('  ğŸ“· ç›¸æœºä½ç½®:', camera.position);
                console.log('  ğŸ¯ ç›¸æœºæœå‘:', camera.rotation);
                console.log('ğŸŒŸ æ‰€æœ‰ç‹®å­åº§æ˜Ÿæ˜Ÿä½ç½®:');
                leoStars.forEach((star, index) => {
                    if (star.userData && star.userData.starData) {
                        console.log(`  ${index}: ${star.userData.starData.name} ä½ç½®:`, star.position);
                    } else {
                        console.log(`  ${index}: æ˜Ÿæ˜Ÿæ•°æ®ç¼ºå¤±`, star.position);
                    }
                });
            }
            
            if (intersects.length > 0) {
                const clickedStar = intersects[0].object;
                console.log('ğŸŠ æˆåŠŸç‚¹å‡»åˆ°æ˜Ÿæ˜Ÿï¼', clickedStar);
                
                if (clickedStar.userData && clickedStar.userData.starData) {
                    const starData = clickedStar.userData.starData;
                    console.log(`â­ ç‚¹å‡»äº†æ˜Ÿæ˜Ÿ: ${starData.name} (${starData.bayer})`);
                    
                    // æ·»åŠ é«˜çº§ç‚¹å‡»æ•ˆæœ
                    const starColor = getStarColor(starData.magnitude);
                    const rgbaColor = `rgba(${(starColor >> 16) & 255}, ${(starColor >> 8) & 255}, ${starColor & 255}, 0.6)`;
                    addRippleEffect(event.clientX, event.clientY, rgbaColor);
                    
                    // æ˜Ÿæ˜Ÿç‚¹å‡»åŠ¨ç”»
                    animateStarClick(clickedStar);
                    
                    // ç¬¬ä¸€æ¬¡ç‚¹å‡»ä»»æ„æ˜Ÿæ˜Ÿéƒ½æ˜¾ç¤ºç”Ÿæ—¥ç¥ç¦
                    if (!firstBlessingShown) {
                        console.log('ğŸ‚ ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œæ˜¾ç¤ºç”Ÿæ—¥ç¥ç¦');
                        firstBlessingShown = true;
                        showBirthdayBlessing();
                    } else {
                        console.log('ğŸ“¸ æ˜¾ç¤ºå›å¿†å†…å®¹');
                        // ç¬¬äºŒæ¬¡ç‚¹å‡»å¼€å§‹æ˜¾ç¤ºå„è‡ªçš„å›å¿†
                        showMemoryModal(starData);
                    }
                } else {
                    console.log('âŒ æ˜Ÿæ˜Ÿæ•°æ®ç¼ºå¤±');
                }
            } else {
                console.log('ğŸŒŒ ç‚¹å‡»äº†ç©ºç™½åŒºåŸŸï¼Œæ·»åŠ ç©ºç™½åŒºåŸŸæ³¢çº¹æ•ˆæœ');
                // ç‚¹å‡»ç©ºç™½å¤„çš„åé¦ˆ
                addRippleEffect(event.clientX, event.clientY, 'rgba(100, 150, 255, 0.2)');
            }
        }

        // æ˜Ÿæ˜Ÿç‚¹å‡»åŠ¨ç”»
        function animateStarClick(star) {
            let progress = 0;
            const duration = 0.6;
            const startTime = performance.now();
            const originalScale = star.scale.x;
            
            const animate = (currentTime) => {
                progress = Math.min((currentTime - startTime) / (duration * 1000), 1);
                
                // å¼¹æ€§ç¼©æ”¾åŠ¨ç”»
                const easeProgress = EasingFunctions.easeOutBack(progress);
                let scale;
                
                if (progress < 0.3) {
                    scale = originalScale + (2.2 - originalScale) * (progress / 0.3);
                } else {
                    scale = 2.2 + (originalScale - 2.2) * ((progress - 0.3) / 0.7);
                }
                
                star.scale.setScalar(scale);
                
                // ä¸´æ—¶å¢å¼ºå‘å…‰æ•ˆæœ
                if (star.material && star.material.emissiveIntensity !== undefined) {
                    star.material.emissiveIntensity = 0.2 + Math.sin(progress * Math.PI * 3) * 0.3;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    star.scale.setScalar(originalScale);
                    if (star.material && star.material.emissiveIntensity !== undefined) {
                        star.material.emissiveIntensity = 0.2;
                    }
                }
            };
            
            requestAnimationFrame(animate);
        }

        // é¼ æ ‡æ‚¬åœäº‹ä»¶ - å¢å¼ºå¾®äº¤äº’
        function onMouseMove(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            
            const intersects = raycaster.intersectObjects(leoStars);
            const tooltip = document.getElementById('constellation-tooltip');
            
            if (intersects.length > 0) {
                const hoveredStar = intersects[0].object;
                const starData = hoveredStar.userData.starData;
                
                // ä¼˜é›…çš„å·¥å…·æç¤ºåŠ¨ç”»
                tooltip.style.opacity = '1';
                tooltip.style.transform = 'translateY(-5px) scale(1)';
                tooltip.style.left = event.clientX + 15 + 'px';
                tooltip.style.top = event.clientY - 40 + 'px';
                
                if (starData.bayer === 'Î± Leo') {
                    tooltip.textContent = `ç‹®å­åº§ - ${starData.name} - ææ˜Ÿå¨…çš„ç”Ÿæ—¥æ˜Ÿåº§ âœ¨`;
                } else {
                    tooltip.textContent = `${starData.name} (${starData.bayer}) - ç‚¹å‡»æŸ¥çœ‹å›å¿†`;
                }
                
                // æµç•…çš„æ˜Ÿæ˜Ÿç¼©æ”¾åŠ¨ç”»
                animateStarHover(hoveredStar, true);
                renderer.domElement.style.cursor = 'pointer';
            } else {
                tooltip.style.opacity = '0';
                tooltip.style.transform = 'translateY(0) scale(0.95)';
                renderer.domElement.style.cursor = 'default';
                
                // é‡ç½®æ‰€æœ‰æ˜Ÿæ˜ŸçŠ¶æ€
                leoStars.forEach(star => {
                    animateStarHover(star, false);
                });
            }
        }

        // æ˜Ÿæ˜Ÿæ‚¬åœåŠ¨ç”» - æ›´ä¼˜é›…çš„æ•ˆæœ
        function animateStarHover(star, isHover) {
            const targetScale = isHover ? 1.1 : 1; // æ›´å…‹åˆ¶
            const currentScale = star.scale.x;
            
            let progress = 0;
            const duration = 0.5; // å¢åŠ åŠ¨ç”»æ—¶é•¿ï¼Œæ›´å¹³æ»‘
            const startTime = performance.now();
            
            // æ›´æ–°å¤šå±‚å…‰æ™•æ•ˆæœ
            if (isHover) {
                // å¢å¼ºæ‰€æœ‰å…‰æ™•å±‚
                if (star.userData.glowLayers) {
                    star.userData.glowLayers.forEach((glow, index) => {
                        const scale = 1.12;
                        glow.scale.set(glow.scale.x * scale, glow.scale.y * scale, 1);
                        const base = glow.userData && glow.userData.baseOpacity ? glow.userData.baseOpacity : 0.5;
                        glow.material.opacity = Math.min(0.75, base + 0.15);
                    });
                }
                // æ˜Ÿä½“æœ¬èº«ä¿æŒç®€æ´
            } else {
                // æ¢å¤æ­£å¸¸å…‰æ™•
                if (star.userData.glowLayers) {
                    star.userData.glowLayers.forEach((glow, index) => {
                        // å°†ç²¾çµå…‰æ™•æ¢å¤åˆ°åŸºç¡€é€æ˜åº¦
                        const base = glow.userData && glow.userData.baseOpacity ? glow.userData.baseOpacity : 0.5;
                        glow.material.opacity = base;
                    });
                }
            }
            
            const animate = (currentTime) => {
                progress = Math.min((currentTime - startTime) / (duration * 1000), 1);
                const easeProgress = EasingFunctions.easeInOutSine(progress); // æ›´å¹³æ»‘çš„ç¼“åŠ¨
                
                const newScale = currentScale + (targetScale - currentScale) * easeProgress;
                star.scale.setScalar(newScale);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            };
            
            requestAnimationFrame(animate);
        }

        // æ˜¾ç¤ºç”Ÿæ—¥ç¥ç¦å¼¹çª—
        function showBirthdayBlessing() {
            console.log('ğŸ‰ showBirthdayBlessing å‡½æ•°è¢«è°ƒç”¨');
            const modal = document.getElementById('blessing-modal');
            const content = document.getElementById('blessing-content');
            const blessingText = document.getElementById('blessing-text');
            
            console.log('ğŸ” DOMå…ƒç´ æ£€æŸ¥:', {
                modal: !!modal,
                content: !!content, 
                blessingText: !!blessingText
            });
            
            if (!modal || !content || !blessingText) {
                console.error('âŒ æ‰¾ä¸åˆ°å¿…è¦çš„DOMå…ƒç´ ');
                return;
            }
            
            // è®¾ç½®ç”Ÿæ—¥ç¥ç¦æ–‡å­—
            blessingText.textContent = 'å®è´ç”Ÿæ—¥å¿«ä¹ï¼';
            console.log('ğŸ“ è®¾ç½®ç¥ç¦æ–‡å­—:', blessingText.textContent);
            
            modal.style.display = 'flex';
            console.log('ğŸ‘ï¸ æ˜¾ç¤ºå¼¹çª—ï¼Œmodal.style.display =', modal.style.display);
            
            setTimeout(() => {
                content.classList.add('show');
                console.log('âœ¨ æ·»åŠ showç±»ï¼ŒclassList:', content.classList.toString());
            }, 100);
            
            // æ·»åŠ æµå…‰æ•ˆæœåˆ°è¿çº¿
            animateConstellationLines();
        }

        // æ˜¾ç¤ºåŸæ¥çš„ç¥ç¦å¼¹çª—ï¼ˆä¿ç•™å¤‡ç”¨ï¼‰
        function showBlessingModal() {
            const modal = document.getElementById('blessing-modal');
            const content = document.getElementById('blessing-content');
            const blessingText = document.getElementById('blessing-text');
            
            // è®¾ç½®åŸæ¥çš„ç¥ç¦æ–‡å­—
            blessingText.textContent = 'ç¥å®è´å¤©å¤©å¼€å¿ƒï¼Œæ°¸è¿œ18å²';
            
            modal.style.display = 'flex';
            setTimeout(() => {
                content.classList.add('show');
            }, 100);
            
            // æ·»åŠ æµå…‰æ•ˆæœåˆ°è¿çº¿
            animateConstellationLines();
        }

        // æ˜Ÿæ˜Ÿå›å¿†æ•°æ®é…ç½® - æ ¹æ®çœŸå®ç…§ç‰‡å†…å®¹å®šåˆ¶
        const starMemories = {
            'Regulus': {
                photo: 'photos/regulus.jpg',
                title: 'Regulus - ç‹è€…ä¹‹æ˜Ÿ â­',
                memory: 'å°±åƒç¹èŠ±ç››å¼€çš„é‚£ä¸€åˆ»ï¼Œä½ çš„ç¬‘å®¹æ˜¯æˆ‘å¿ƒä¸­æœ€äº®çš„å…‰ã€‚åœ¨è¿™ä¸ªå……æ»¡æ¸©é¦¨èŠ±æœµçš„åœ°æ–¹ï¼Œæˆ‘ä»¬çš„çˆ±æƒ…ä¹Ÿå¦‚èŠ±èˆ¬ç»½æ”¾ ğŸŒ¸âœ¨'
            },
            'Denebola': {
                photo: 'photos/denebola.jpg', 
                title: 'Denebola - ç‹®å­çš„å°¾å·´ ğŸ¦',
                memory: 'åœ¨èŒ«èŒ«æˆˆå£ä¸­ï¼Œæ¯æ¬¡å›å¤´éƒ½èƒ½çœ‹åˆ°ä½ ç¿çƒ‚çš„èº«å½±ã€‚é‚£ä¸ªæ²™æ¼ åˆåï¼Œä½ ä¿çš®çš„å§¿åŠ¿å®šæ ¼äº†æˆ‘ä»¬é’æ˜¥æœ€ç¾çš„æ—¶å…‰ ğŸœï¸ğŸ’«'
            },
            'Algieba': {
                photo: 'photos/algieba.jpg',
                title: 'Algieba - ç‹®å­çš„é¢å¤´ ğŸŒ„',
                memory: 'ç«™åœ¨å±±å·…ä¸ä½ å¹¶è‚©ï¼Œä»¿ä½›æ‹¥æœ‰äº†æ•´ä¸ªä¸–ç•Œçš„é£å…‰ã€‚é‚£ç‰‡å£®ç¾çš„æˆˆå£é«˜åœ°è§è¯äº†æˆ‘ä»¬çš„å±±ç›Ÿæµ·èª“ â›°ï¸ğŸ’•'
            },
            'Zosma': {
                photo: 'photos/zosma.jpg',
                title: 'Zosma - ç‹®å­çš„è…°éƒ¨ â˜ï¸',
                memory: 'åœ¨é‚£ç‰‡è”šè“çš„å¤©ç©ºä¸‹ï¼Œæ—¶å…‰é™å¥½ï¼Œæœ‰ä½ å°±æ˜¯æ™´å¤©ã€‚ç°ä»£å»ºç­‘ä¹Ÿæ¯”ä¸è¿‡ä½ çœ¼ä¸­çš„æ˜Ÿå…‰ç’€ç’¨ ğŸ™ï¸ğŸ’™'
            },
            'Algenubi': {
                photo: 'photos/algenubi.jpg',
                title: 'Algenubi - ç‹®å­çš„é¼»å­ â„ï¸',
                memory: 'é›ªèŠ±é£èˆçš„æ—¥å­é‡Œï¼Œä½ å˜Ÿå˜´çš„æ¨¡æ ·æ¯”é›ªèŠ±æ›´å¯çˆ±ã€‚æ¯›ç»’å¸½å­ä¸‹çš„ä½ ï¼Œåƒä¸ªå†¬æ—¥é‡Œçš„å°å¤©ä½¿ â˜ƒï¸ğŸ˜˜'
            },
            'Adhafera': {
                photo: 'photos/adhafera.jpg',
                title: 'Adhafera - ç‹®å­çš„é¬ƒæ¯› ğŸš¡',
                memory: 'ç¼†è½¦æ‘‡æ‘†é—´ï¼Œä½ çš„å‘ä¸åœ¨é£ä¸­èˆè¹ˆï¼Œç¾å¾—åƒè¯—ã€‚é‚£ä¸ªVå­—æ‰‹åŠ¿å®šæ ¼äº†æˆ‘ä»¬æœ€å¼€å¿ƒçš„æ—…è¡Œæ—¶å…‰ ğŸ“¸ğŸ’›'
            },
            'Al Jabhah': {
                photo: 'photos/al-jabhah.jpg',
                title: 'Al Jabhah - ç‹®å­çš„å‰é¢ ğŸŒƒ',
                memory: 'åç¯åˆä¸Šçš„åŸå¸‚é‡Œï¼Œä½ æ˜¯æˆ‘çœ¼ä¸­æœ€äº®çš„é‚£ç›ç¯ã€‚å¤œå¹•ä¸‹çš„åˆå½±ï¼Œè®°å½•ç€æˆ‘ä»¬æœ€æµªæ¼«çš„éƒ½å¸‚æ—¶å…‰ ğŸŒ†ğŸ’«'
            },
            'Chertan': {
                photo: 'photos/chertan.jpg',
                title: 'Chertan - ç‹®å­çš„è‚‹éª¨ ğŸ’',
                memory: 'é‚£ä¸ªæ‹¥æŠ±çš„ç¬é—´ï¼Œæˆ‘å¬åˆ°äº†ä¸¤é¢—å¿ƒåŒæ­¥è·³åŠ¨çš„å£°éŸ³ã€‚ç°ä»£å»ºç­‘è§è¯äº†æˆ‘ä»¬æœ€ç”œèœœçš„ç›¸æ‹¥æ—¶åˆ» ğŸ¢ğŸ’“'
            },
            'Rasalas': {
                photo: 'photos/rasalas.jpg',
                title: 'Rasalas - ç‹®å­çš„å¤´é¡¶ ğŸ”ï¸',
                memory: 'é•¿ç™½å±±ä¸‹è®¸ä¸‹çš„è¯ºè¨€ï¼Œè¦å’Œä½ çœ‹éäººé—´æ‰€æœ‰çš„é›ªæ™¯ã€‚é‚£ä¸ªæµªæ¼«çš„æ¯”å¿ƒæ‰‹åŠ¿ï¼Œæ˜¯æˆ‘ä»¬çˆ±æƒ…æœ€ç¾çš„å°ç«  ğŸ¤ğŸ‘«'
            }
        };

        // æ˜¾ç¤ºå›å¿†å¼¹çª—
        function showMemoryModal(starData) {
            console.log('ğŸ“¸ showMemoryModal å‡½æ•°è¢«è°ƒç”¨ï¼Œæ˜Ÿæ˜Ÿ:', starData.name);
            const modal = document.getElementById('memory-modal');
            const card = document.getElementById('memory-card');
            const imageContainer = document.getElementById('memory-image');
            const title = document.getElementById('memory-title');
            const description = document.getElementById('memory-description');
            
            console.log('ğŸ” å›å¿†å¼¹çª—DOMå…ƒç´ æ£€æŸ¥:', {
                modal: !!modal,
                card: !!card, 
                imageContainer: !!imageContainer,
                title: !!title,
                description: !!description
            });
            
            // æ·»åŠ åˆ°å·²ç‚¹å‡»æ˜Ÿæ˜Ÿåˆ—è¡¨
            clickedStars.add(starData.name);
            console.log(`å·²ç‚¹å‡»æ˜Ÿæ˜Ÿ: ${clickedStars.size}/9`);
            
            // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
            updateProgressIndicator();
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ˜Ÿæ˜Ÿéƒ½è¢«ç‚¹å‡»
            if (clickedStars.size === 9 && !allStarsClickedTriggered) {
                allStarsClickedTriggered = true;
                setTimeout(() => {
                    triggerCompletionEasterEgg();
                }, 1000); // å»¶è¿Ÿ1ç§’è§¦å‘å½©è›‹
            }
            
            const memory = starMemories[starData.name] || {
                photo: null,
                title: starData.name + ' çš„å›å¿†',
                memory: `è¿™æ˜¯å…³äº${starData.name}æ˜Ÿçš„ç¾å¥½å›å¿†...`
            };
            
            // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
            imageContainer.innerHTML = '';
            
            // å°è¯•åŠ è½½ç…§ç‰‡
            const img = new Image();
            img.onload = function() {
                imageContainer.innerHTML = `<img src="${memory.photo}" alt="${starData.name}çš„å›å¿†">`;
            };
            img.onerror = function() {
                // ç…§ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºå ä½ç¬¦
                imageContainer.innerHTML = `
                    <div class="placeholder-text">
                        <div style="font-size: 2rem;">ğŸ“¸</div>
                        <div>${starData.name} çš„ç…§ç‰‡</div>
                        <div style="font-size: 0.8rem; margin-top: 10px;">
                            è¯·å°†ç…§ç‰‡å‘½åä¸º ${starData.name.toLowerCase()}.jpg<br/>
                            å¹¶æ”¾ç½®åœ¨ photos/ æ–‡ä»¶å¤¹ä¸­
                        </div>
                    </div>
                `;
            };
            
            if (memory.photo) {
                img.src = memory.photo;
            } else {
                img.onerror();
            }
            
            title.textContent = memory.title;
            description.textContent = memory.memory;
            
            modal.style.display = 'flex';
            setTimeout(() => {
                card.classList.add('show');
            }, 100);
        }

        // å…³é—­ç¥ç¦å¼¹çª—
        function closeBlessingModal(event) {
            if (event.target.id === 'blessing-modal') {
                const modal = document.getElementById('blessing-modal');
                const content = document.getElementById('blessing-content');
                
                content.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 500);
            }
        }

        // å…³é—­å›å¿†å¼¹çª—
        function closeMemoryModal(event) {
            if (event.target.id === 'memory-modal') {
                const modal = document.getElementById('memory-modal');
                const card = document.getElementById('memory-card');
                
                card.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 500);
            }
        }

        // æ˜Ÿåº§è¿çº¿æµå…‰åŠ¨ç”»
        function animateConstellationLines() {
            // ç®€åŒ–ä¸ºè½»å¾®æ·¡å…¥æ•ˆæœ
            leoLines.forEach((line, index) => {
                const material = line.material;
                const base = material.opacity;
                material.opacity = 0;
                const start = performance.now();
                const duration = 800;
                const step = (t) => {
                    const p = Math.min((t - start) / duration, 1);
                    material.opacity = base * p;
                    if (p < 1) requestAnimationFrame(step);
                };
                setTimeout(() => requestAnimationFrame(step), index * 120);
            });
        }

        // å¼€åœºåŠ¨ç”»
        function startOpeningAnimation() {
            const openingMask = document.getElementById('opening-mask');
            const music = document.getElementById('background-music');
            
            // 4ç§’åå¼€å§‹æ·¡å‡ºå¼€åœºåŠ¨ç”»
            setTimeout(() => {
                openingMask.style.opacity = '0';
                
                // å¼€å§‹æ’­æ”¾éŸ³ä¹
                if (music) {
                    music.play().catch(e => {
                        console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’');
                    });
                    musicPlaying = true;
                }
                
                setTimeout(() => {
                    openingMask.classList.add('hidden');
                    
                    // èšç„¦åˆ°ç‹®å­åº§
                    focusOnLeo();
                }, 2000);
            }, 4000);
        }

        // é«˜çº§ç¼“åŠ¨å‡½æ•°
        const EasingFunctions = {
            // ä¼˜é›…çš„è¿›å…¥åŠ¨ç”»
            easeOutCubic: t => 1 - Math.pow(1 - t, 3),
            // å¼¹æ€§åŠ¨ç”»
            easeOutBack: t => {
                const c1 = 1.70158;
                const c3 = c1 + 1;
                return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);
            },
            // æµç•…çš„åŒå‘åŠ¨ç”»
            easeInOutQuart: t => t < 0.5 ? 8 * t * t * t * t : 1 - Math.pow(-2 * t + 2, 4) / 2,
            // ç»†è…»çš„æµ®åŠ¨åŠ¨ç”»
            easeInOutSine: t => -(Math.cos(Math.PI * t) - 1) / 2
        };

        // èšç„¦åˆ°ç‹®å­åº§
        function focusOnLeo() {
            if (leoStars.length > 0) {
                // è®¡ç®—ç‹®å­åº§ä¸­å¿ƒç‚¹
                const center = new THREE.Vector3();
                leoStars.forEach(star => {
                    center.add(star.position);
                });
                center.divideScalar(leoStars.length);
                
                // è°ƒæ•´ç›¸æœºä½ç½®è®©ç‹®å­åº§å‘ˆç°æ¨ªå‘å§¿æ€ï¼ˆå¤´æœå³ä¸Šï¼‰
                const startPosition = camera.position.clone();
                const startTarget = controls.target.clone();
                
                // ç›®æ ‡ä½ç½®ï¼šæœ€ä½³è·ç¦»è§‚å¯Ÿç‹®å­åº§ï¼Œè®©å®ƒå æ®ç”»é¢ä¸»è¦éƒ¨åˆ†
                const targetPosition = center.clone().add(new THREE.Vector3(-2, -3, 4));
                const targetLookAt = center.clone();
                
                let progress = 0;
                const duration = 80; // å¸§æ•°ï¼Œçº¦2.7ç§’@30fps
                
                const animateCamera = () => {
                    progress += 1 / duration;
                    
                    if (progress <= 1) {
                        // ä½¿ç”¨é«˜çº§ç¼“åŠ¨å‡½æ•°ï¼Œå…ˆå¿«åæ…¢çš„ä¼˜é›…è¿‡æ¸¡
                        const easeProgress = EasingFunctions.easeOutCubic(progress);
                        
                        camera.position.lerpVectors(startPosition, targetPosition, easeProgress);
                        controls.target.lerpVectors(startTarget, targetLookAt, easeProgress);
                        controls.update();
                        requestAnimationFrame(animateCamera);
                    } else {
                        camera.position.copy(targetPosition);
                        controls.target.copy(targetLookAt);
                        controls.update();
                        
                        // èšç„¦å®Œæˆåæ·»åŠ å¾®å¦™çš„å‘¼å¸åŠ¨ç”»
                        addCameraBreathingEffect();
                    }
                };
                animateCamera();
            }
        }

        // æ·»åŠ ç›¸æœºå‘¼å¸æ•ˆæœ
        function addCameraBreathingEffect() {
            let breathTime = 0;
            const originalPosition = camera.position.clone();
            
            const breathe = () => {
                breathTime += 0.01;
                const breathOffset = Math.sin(breathTime) * 0.02;
                camera.position.z = originalPosition.z + breathOffset;
                controls.update();
                requestAnimationFrame(breathe);
            };
            
            // å»¶è¿Ÿå¯åŠ¨å‘¼å¸æ•ˆæœ
            setTimeout(breathe, 1000);
        }

        // éŸ³ä¹æ§åˆ¶
        function toggleMusic() {
            console.log('ğŸµ éŸ³ä¹æ§åˆ¶æŒ‰é’®è¢«ç‚¹å‡»');
            const music = document.getElementById('background-music');
            const control = document.getElementById('music-control');
            
            console.log('ğŸ¶ å½“å‰éŸ³ä¹çŠ¶æ€:', {
                musicPlaying: musicPlaying,
                musicElement: !!music,
                controlElement: !!control
            });
            
            if (musicPlaying) {
                music.pause();
                control.textContent = 'ğŸ”‡ éŸ³ä¹';
                musicPlaying = false;
                console.log('â¸ï¸ éŸ³ä¹å·²æš‚åœ');
            } else {
                music.play().then(() => {
                    control.textContent = 'ğŸµ éŸ³ä¹';
                    musicPlaying = true;
                    console.log('â–¶ï¸ éŸ³ä¹å¼€å§‹æ’­æ”¾');
                }).catch(e => {
                    console.log('âŒ éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    control.textContent = 'ğŸ”‡ æ’­æ”¾å¤±è´¥';
                });
            }
        }

        // çª—å£å¤§å°æ”¹å˜
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // åŠ¨ç”»å¾ªç¯ - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
        let lastRenderTime = 0;
        let frameCount = 0;
        const targetFPS = 60;
        const renderInterval = 1000 / targetFPS;
        
        function animate(currentTime) {
            requestAnimationFrame(animate);
            
            // é™åˆ¶æ¸²æŸ“é¢‘ç‡ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—
            if (currentTime - lastRenderTime >= renderInterval) {
                frameCount++;
                
                // æ›´æ–°æ§åˆ¶å™¨
                if (controls) controls.update();
                
                // æ˜Ÿç©ºç¼“æ…¢æ—‹è½¬ï¼ˆé™ä½é¢‘ç‡åˆ°æ¯10å¸§ä¸€æ¬¡ï¼‰
                if (starField && frameCount % 10 === 0) {
                    starField.rotation.y += 0.001;
                }
                
                // ç‹®å­åº§æ˜Ÿæ˜Ÿé—ªçƒæ•ˆæœï¼ˆé™ä½é¢‘ç‡åˆ°æ¯5å¸§ä¸€æ¬¡ï¼‰
                if (frameCount % 5 === 0) {
                    const time = currentTime * 0.001;
                    leoStars.forEach((star, index) => {
                        if (star.material) {
                            // å‡å¼±é—ªçƒï¼Œé¿å…åˆºçœ¼
                            star.material.opacity = 0.9 + Math.sin(time * 0.6 + index * 0.3) * 0.03;
                        }
                        // æ›´æ–°æ˜Ÿæ˜Ÿå…‰æ™•å±‚
                        if (star.userData.glowLayers) {
                            star.userData.glowLayers.forEach((glow, layerIndex) => {
                                if (glow.material) {
                                    const base = glow.userData && glow.userData.baseOpacity ? glow.userData.baseOpacity : 0.5;
                                    glow.material.opacity = base + Math.sin(time * 0.4 + index) * 0.06;
                                }
                            });
                        }
                    });
                }
                
                // å·²ç§»é™¤æµå…‰ç²’å­æ›´æ–°
                
                // æ¸²æŸ“åœºæ™¯
                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
                
                lastRenderTime = currentTime;
            }
        }

        // è§¦å‘å®Œæˆå½©è›‹
        function triggerCompletionEasterEgg() {
            console.log('è§¦å‘å®Œæˆå½©è›‹ï¼');
            
            // 1. è®©ç‹®å­åº§å‘å‡ºæ›´äº®çš„å…‰
            enhanceLeoGlow();
            
            // 2. æ˜¾ç¤ºéšè—ç¥ç¦
            setTimeout(() => {
                showHiddenBlessing();
            }, 2000);
        }

        // å¢å¼ºç‹®å­åº§å…‰èŠ’
        function enhanceLeoGlow() {
            leoStars.forEach(star => {
                // ä¸ºæ¯é¢—æ˜Ÿæ˜Ÿæ·»åŠ æ›´äº®çš„å…‰æ•ˆ
                const position = star.position;
                
                // åˆ›å»ºæ›´äº®çš„å…‰èŠ’
                const brightGlowGeometry = new THREE.SphereGeometry(0.3, 16, 16);
                const brightGlowMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.8
                });
                const brightGlow = new THREE.Mesh(brightGlowGeometry, brightGlowMaterial);
                brightGlow.position.copy(position);
                
                scene.add(brightGlow);
                
                // åŠ¨ç”»æ•ˆæœ
                let scale = 1;
                const animateBrightGlow = () => {
                    scale += 0.02;
                    brightGlow.scale.setScalar(scale);
                    brightGlowMaterial.opacity = Math.max(0, 0.8 - (scale - 1) * 0.4);
                    
                    if (scale < 3) {
                        requestAnimationFrame(animateBrightGlow);
                    } else {
                        scene.remove(brightGlow);
                    }
                };
                
                setTimeout(() => animateBrightGlow(), Math.random() * 1000);
            });
        }

        // æ˜¾ç¤ºéšè—ç¥ç¦
        function showHiddenBlessing() {
            // åˆ›å»ºéšè—ç¥ç¦å¼¹çª—
            const hiddenModal = document.createElement('div');
            hiddenModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 600;
                backdrop-filter: blur(15px);
                opacity: 0;
                transition: opacity 2s ease-out;
            `;
            
            const hiddenContent = document.createElement('div');
            hiddenContent.style.cssText = `
                text-align: center;
                color: #fff;
                font-family: 'Dancing Script', cursive;
                font-size: 3rem;
                font-weight: 700;
                text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
                animation: sparkle 2s ease-in-out infinite;
                opacity: 0;
                transform: translateY(30px);
                transition: all 2s ease-out;
            `;
            
            hiddenContent.innerHTML = `
                <div style="margin-bottom: 30px;">ğŸŒŸ</div>
                <div>ä½ çš„æ¯ä¸€ä¸ªç¬é—´ï¼Œ</div>
                <div>éƒ½æ¯”æ˜Ÿæ˜Ÿæ›´äº®</div>
                <div style="margin-top: 30px; font-size: 2rem;">âœ¨ğŸ’•âœ¨</div>
            `;
            
            hiddenModal.appendChild(hiddenContent);
            document.body.appendChild(hiddenModal);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                hiddenModal.style.opacity = '1';
                hiddenContent.style.opacity = '1';
                hiddenContent.style.transform = 'translateY(0)';
            }, 100);
            
            // å¼€å§‹æ˜Ÿç©ºæ—‹è½¬æ•ˆæœ
            setTimeout(() => {
                startFinalRotation();
            }, 5000);
            
            // 8ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                hiddenModal.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(hiddenModal);
                }, 2000);
            }, 8000);
        }

        // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
        function updateProgressIndicator() {
            const progressCount = document.getElementById('progress-count');
            const progressFill = document.getElementById('progress-fill');
            
            if (progressCount && progressFill) {
                progressCount.textContent = clickedStars.size;
                const percentage = (clickedStars.size / 9) * 100;
                progressFill.style.width = percentage + '%';
                
                // å¦‚æœæ¥è¿‘å®Œæˆï¼Œæ·»åŠ ç‰¹æ®Šæ•ˆæœ
                if (clickedStars.size >= 7) {
                    progressFill.style.background = 'linear-gradient(90deg, #ff6b9d, #ffd700)';
                    progressFill.style.boxShadow = '0 0 15px rgba(255, 107, 157, 0.6)';
                }
            }
        }

        // é«˜çº§ç‚¹å‡»æ³¢çº¹æ•ˆæœ
        function addRippleEffect(x, y, color = 'rgba(255, 255, 255, 0.4)') {
            const ripple = document.createElement('div');
            const size = 80 + Math.random() * 40; // éšæœºå¤§å°
            
            ripple.style.cssText = `
                position: fixed;
                border-radius: 50%;
                background: radial-gradient(circle, ${color} 0%, transparent 70%);
                transform: scale(0);
                left: ${x - size/2}px;
                top: ${y - size/2}px;
                width: ${size}px;
                height: ${size}px;
                pointer-events: none;
                z-index: 1000;
                animation: premiumRipple 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
                box-shadow: 0 0 20px ${color};
            `;
            
            document.body.appendChild(ripple);
            
            ripple.addEventListener('animationend', () => {
                document.body.removeChild(ripple);
            });
            
            // æ·»åŠ é¢å¤–çš„ç²’å­æ•ˆæœ
            addParticleExplosion(x, y, color);
        }

        // ç²’å­çˆ†ç‚¸æ•ˆæœ
        function addParticleExplosion(x, y, color) {
            const particleCount = 6 + Math.random() * 4;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const angle = (Math.PI * 2 * i) / particleCount;
                const velocity = 40 + Math.random() * 30;
                const size = 2 + Math.random() * 3;
                
                particle.style.cssText = `
                    position: fixed;
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: 50%;
                    left: ${x}px;
                    top: ${y}px;
                    pointer-events: none;
                    z-index: 999;
                    animation: particleFloat 1.2s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
                    transform-origin: center center;
                `;
                
                particle.style.setProperty('--dx', Math.cos(angle) * velocity + 'px');
                particle.style.setProperty('--dy', Math.sin(angle) * velocity + 'px');
                
                document.body.appendChild(particle);
                
                particle.addEventListener('animationend', () => {
                    document.body.removeChild(particle);
                });
            }
        }

        // æ·»åŠ åŠ¨ç”»å…³é”®å¸§
        const premiumStyleSheet = document.createElement('style');
        premiumStyleSheet.textContent = `
            @keyframes premiumRipple {
                0% { 
                    transform: scale(0); 
                    opacity: 1; 
                }
                100% { 
                    transform: scale(1); 
                    opacity: 0; 
                }
            }
            
            @keyframes particleFloat {
                0% {
                    transform: translate(0, 0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translate(var(--dx), var(--dy)) scale(0);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(premiumStyleSheet);

        // æœ€ç»ˆæ˜Ÿç©ºæ—‹è½¬æ•ˆæœ
        function startFinalRotation() {
            console.log('ğŸ¬ å¼€å§‹æœ€ç»ˆæ—‹è½¬æ·¡å‡ºæ•ˆæœ');
            let rotationProgress = 0;
            const rotationDuration = 6000; // 6ç§’
            const startTime = performance.now();
            
            function rotateAndFade(currentTime) {
                const elapsed = currentTime - startTime;
                rotationProgress = Math.min(elapsed / rotationDuration, 1);
                
                if (scene) {
                    // ç¼“æ…¢æ—‹è½¬æ•´ä¸ªåœºæ™¯
                    scene.rotation.y += 0.003 * (1 - rotationProgress * 0.5);
                    scene.rotation.x += 0.0015 * (1 - rotationProgress * 0.5);
                    
                    // é€æ¸æ·¡å‡º
                    if (rotationProgress > 0.4) {
                        const fadeProgress = (rotationProgress - 0.4) / 0.6;
                        renderer.domElement.style.opacity = 1 - fadeProgress;
                    }
                }
                
                if (rotationProgress < 1) {
                    requestAnimationFrame(rotateAndFade);
                } else {
                    console.log('âœ¨ æœ€ç»ˆæ•ˆæœå®Œæˆï¼Œæ˜¾ç¤ºç»“æŸç”»é¢');
                    showFinalEndingScreen();
                }
            }
            
            requestAnimationFrame(rotateAndFade);
        }
        
        // æœ€ç»ˆç»“æŸç”»é¢
        function showFinalEndingScreen() {
            console.log('ğŸ‰ æ˜¾ç¤ºæœ€ç»ˆç»“æŸç”»é¢');
            
            // åˆ›å»ºç»“æŸç”»é¢é®ç½©
            const endingScreen = document.createElement('div');
            endingScreen.id = 'final-ending-screen';
            endingScreen.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                opacity: 0;
                transition: opacity 2s ease-in-out;
            `;
            
            // åˆ›å»ºæœ€ç»ˆç¥ç¦æ–‡å­—
            const finalMessage = document.createElement('div');
            finalMessage.style.cssText = `
                font-family: 'Dancing Script', cursive;
                font-size: 3.5rem;
                font-weight: 600;
                color: #fff;
                text-align: center;
                text-shadow: 0 0 20px rgba(255, 215, 0, 0.8),
                           0 0 40px rgba(255, 215, 0, 0.6),
                           0 0 60px rgba(255, 215, 0, 0.4);
                letter-spacing: 2px;
                line-height: 1.3;
                margin-bottom: 2rem;
                opacity: 0;
                transform: translateY(30px) scale(0.9);
                transition: all 3s ease-out;
            `;
            finalMessage.innerHTML = 'æˆ‘çš„å®è´ç”Ÿæ—¥å¿«ä¹ï¼<br><span style="font-size: 2rem; color: rgba(255, 215, 0, 0.9);">æ„¿ä½ æ°¸è¿œå¦‚æ˜Ÿå…‰èˆ¬é—ªè€€ âœ¨</span>';
            
            // åˆ›å»ºè£…é¥°æ€§ç²’å­æ•ˆæœ
            const particlesContainer = document.createElement('div');
            particlesContainer.style.cssText = `
                position: absolute;
                width: 100%;
                height: 100%;
                pointer-events: none;
                overflow: hidden;
            `;
            
            // æ·»åŠ å¤šä¸ªé—ªçƒç²’å­
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: radial-gradient(circle, #ffd700, transparent);
                    border-radius: 50%;
                    animation: finalSparkle ${2 + Math.random() * 3}s infinite ease-in-out;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation-delay: ${Math.random() * 2}s;
                `;
                particlesContainer.appendChild(particle);
            }
            
            // æ·»åŠ CSSåŠ¨ç”»
            const finalStyles = document.createElement('style');
            finalStyles.textContent = `
                @keyframes finalSparkle {
                    0%, 100% { opacity: 0; transform: scale(0); }
                    50% { opacity: 1; transform: scale(1); }
                }
                
                @media (max-width: 768px) {
                    #final-ending-screen div:first-child {
                        font-size: 2.5rem !important;
                    }
                    #final-ending-screen span {
                        font-size: 1.5rem !important;
                    }
                }
                
                @media (max-width: 480px) {
                    #final-ending-screen div:first-child {
                        font-size: 2rem !important;
                        padding: 0 20px;
                    }
                    #final-ending-screen span {
                        font-size: 1.2rem !important;
                    }
                }
            `;
            document.head.appendChild(finalStyles);
            
            // ç»„è£…å¹¶æ·»åŠ åˆ°é¡µé¢
            endingScreen.appendChild(particlesContainer);
            endingScreen.appendChild(finalMessage);
            document.body.appendChild(endingScreen);
            
            // æ·¡å…¥åŠ¨ç”»
            setTimeout(() => {
                endingScreen.style.opacity = '1';
            }, 100);
            
            // æ–‡å­—å‡ºç°åŠ¨ç”»
            setTimeout(() => {
                finalMessage.style.opacity = '1';
                finalMessage.style.transform = 'translateY(0) scale(1)';
            }, 1000);
            
            // éšè—æ‰€æœ‰å…¶ä»–å…ƒç´ 
            setTimeout(() => {
                const elementsToHide = ['canvas-container', 'music-control', 'progress-indicator', 'controls-hint', 'constellation-tooltip'];
                elementsToHide.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.style.display = 'none';
                });
            }, 2000);
            
            console.log('ğŸŠ æœ€ç»ˆç»“æŸç”»é¢æ˜¾ç¤ºå®Œæˆ');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            // æ£€æŸ¥Three.jsæ˜¯å¦åŠ è½½
            if (typeof THREE === 'undefined') {
                console.error('âŒ Three.jsåº“æœªåŠ è½½ï¼');
                alert('Three.jsåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢');
                return;
            }
            console.log('âœ… Three.jsåº“åŠ è½½æˆåŠŸï¼Œç‰ˆæœ¬:', THREE.REVISION);
            
            // æ£€æŸ¥å¿…è¦çš„DOMå…ƒç´ 
            const requiredElements = [
                'canvas-container',
                'opening-mask', 
                'opening-text',
                'blessing-modal',
                'memory-modal'
            ];
            
            let missingElements = [];
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    missingElements.push(id);
                }
            });
            
            if (missingElements.length > 0) {
                console.error('âŒ ç¼ºå°‘å¿…è¦çš„DOMå…ƒç´ :', missingElements);
                alert('é¡µé¢ç»“æ„ä¸å®Œæ•´ï¼Œç¼ºå°‘å…ƒç´ ï¼š' + missingElements.join(', '));
                return;
            }
            console.log('âœ… æ‰€æœ‰å¿…è¦çš„DOMå…ƒç´ éƒ½å­˜åœ¨');
            
            // å¼€å§‹åˆå§‹åŒ–
            init();
        });
    </script>
</body>
</html>
